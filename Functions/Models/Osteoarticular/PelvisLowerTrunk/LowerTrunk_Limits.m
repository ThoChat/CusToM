function [OsteoArticularModel]= LowerTrunk_Limits(OsteoArticularModel,k,Mass,AttachmentPoint)
%% Implementation of a model of the spine with 5 lumbar vertebrae
% Ce modèle inclut 5 solides associés aux vertèbres lombaires et articulés
% entre eux suivant 3 degrés de liberté en rotation.
% Il s'insert au dessus du modèle "PelvisNoTrunk" pour le bassin et permet
% d'accrocher un modèle supérieur de la région thoracique.
% Auteurs : A. Schuster, G. Dumont, C. Pontonnier (2023)

%% Les données anthropométriques pour ce modèle sont issues des travaux de
% Bayoglu et al. (2017a,b).
% (Twente spine model: a complete and coherent dataset for musculo-skeletal
% modeling of the lumbar region of the human spine ;
%  Twente spine model: a complete and coherent dataset for musculo-skeletal
% modeling of the thoracic and cervical regions of the human spine
%
%% Comit 2025, authors: Minh Nguyen, Aurélien Schuster, Aurélie Tomezzoli
% Version avec limites articulaires
%
% You can run this model with the markersets
% - Marker_setSpine
% - Marker_setSpinePOSSUP
%
% In this case, virtual markers corresponding to the posterosuperior corners of the vertebrae are used to drive the kinematic model, as if they were skin markers. 
% % Before running the analysis in CUSTOM, you MUST compute the predicted vertebral positions using the regressions available here:
% Tomezzoli, A., A. Agouram, B. Chalamet, et al. ‘Predicting Cervico-Thoraco-Lumbar Vertebra Positions from Cutaneous Markers: Combining Local Frame and Postural Predictors Improves Robustness to Posture’. Journal of Biomechanics 164 (February 2024): 111961. https://doi.org/10.1016/j.jbiomech.2024.111961.
% 
% You MUST use simultaneously these model parts:
% UpperTrunkCervical_KinRhythm + LowerTrunk_KinRhythm + Skull    OR
% UpperTrunkCervical_Limits    + LowerTrunk_Limits   + Skull.m  OR 
% UpperTrunkCervical_NoLimits  + LowerTrunk_NoLimits + Skull.m
%
% Dof outside the sagittal plane have been disabled.


[OsteoArticularModel]= PelvisNoTrunk(OsteoArticularModel,k,Mass,AttachmentPoint); %On reprend àp du pelvis
% [OsteoArticularModel]= Pelvis_TLEMNoTrunk(OsteoArticularModel,k,Mass,AttachmentPoint); %On reprend àp du pelvis

list_solid={'L5_J1' 'L5_J2' 'L5'...
            'L4_J1' 'L4_J2' 'L4'...
            'L3_J1' 'L3_J2' 'L3'...
            'L2_J1' 'L2_J2' 'L2'...
            'L1_J1' 'L1_J2' 'L1'...
             };
    
%% solid numbering incremation

s=size(OsteoArticularModel,2)+1;  %#ok<NASGU> % number of the first solid
for i=1:size(list_solid,2)      % each solid numbering: s_"nom du solide"
    if i==1
        eval(strcat('s_',list_solid{i},'=s;'))
    else
        eval(strcat('s_',list_solid{i},'=s_',list_solid{i-1},'+1;'))
    end
end  
    
% find the number of the mother from the attachment point: 'attachment_pt'
attachment_pt = 'Pelvis_LowerTrunkNode';
test=0;
for i=1:numel(OsteoArticularModel)
    for j=1:size(OsteoArticularModel(i).anat_position,1)
        if strcmp(attachment_pt,OsteoArticularModel(i).anat_position{j,1})
           s_mother=i;
           pos_attachment_pt=OsteoArticularModel(i).anat_position{j,2}+OsteoArticularModel(s_mother).c;
           test=1;
           break
        end
    end
    if i==numel(OsteoArticularModel) && test==0
        error([attachment_pt ' is no existent'])        
    end       
end
if OsteoArticularModel(s_mother).child == 0      % if the mother don't have any child
    OsteoArticularModel(s_mother).child = eval(['s_' list_solid{1}]);    % the child of this mother is this solid
else
    [OsteoArticularModel]=sister_actualize(OsteoArticularModel,OsteoArticularModel(s_mother).child,eval(['s_' list_solid{1}]));   % recherche de la derni�re soeur
end     


%% Definition of anatomical landmarks for the segments(CoM wrt global RF ; Node wrt local RF on CoM)

%Matrice de rotation de la base du CT-Scan vers la base suivie par les recommendations de l'ISB
M = [0 -1 0 ;...
     0 0 1  ;...
    -1 0 0  ];

%Matrice de symétrie pour le changement gauche/droite

S = [1 0 0 ;...
     0 1 0 ;...
     0 0 -1];

%Coeff de regression pour le cadavre de 1m54 :

% k_new = k * (1.80/1.54);
k_new = k ;

%Position des articulations telle que la moyenne des deux corps de %%%%%%%%
%vertèbres (sup+inf)/2 dans le repère du CT-scan: %%%%%%%%%%%%%%%%%%%%%%%%%
%Calcul des longueurs des vertèbres (entre les deux corps vertébraux): %%%%

% Lombaires %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%Calcul des centres de liaisons comme la moyenne entre les deux extrémités
%sur les corps vertébraux :
%L5
L5_inf = M*k_new*[-2.9904 -79.4992 692.74]'*0.001 ;
L5_sup = M*k_new*[-5.3757 -96.2936 709.719]'*0.001 ;
L5_length = norm(L5_sup-L5_inf);
L4_inf = M*k_new*[-3.4144 -100.365 710.328]'*0.001 ;
L5_L4CT = (L5_sup+L4_inf)/2;        

%L4
L4_sup = M*k_new*[-3.5914 -108.569 734.236]'*0.001;
L4_length = norm(L4_sup-L4_inf);
L3_inf = M*k_new*[-1.3649 -113.081 743.652]'*0.001 ;
L4_L3CT = (L4_sup+L3_inf)/2 ;

%L3
L3_sup = M*k_new*[-1.3364 -112.546 767.612]'*0.001;
L3_length = norm(L3_sup-L3_inf);
L2_inf = M*k_new*[-2.2401 -111.985 775.05]'*0.001 ;
L3_L2CT = (L3_sup+L2_inf)/2 ;

%L2
L2_sup = M*k_new*[-2.4577 -109.706 800.086]'*0.001;
L2_length = norm(L2_sup-L2_inf);
L1_inf = M*k_new*[-2.0244 -104.134 807.88]'*0.001 ;
L2_L1CT = (L2_sup+L1_inf)/2;

%L1
L1_sup = M*k_new*[-1.2769 -101.421 832.204]'*0.001;
L1_length = norm(L1_sup-L1_inf);
T12_inf = M*k_new*[-0.4485 -97.7597 839.097]'*0.001;
Thorax_inf = T12_inf ;
L1_ThoraxCT = (L1_sup+Thorax_inf)/2;

%Position du CoM du segment enfant par rapport au repère associé au segment parent
% avec les paramètres de Pearsall et al. (1996) (Chaîne cinématique)
% Dans Pearsall et al. on a :
% x transverse ;
% y anteropostérieur ;
% z longitudinal mais vers le bas : on a fait le changement pour 'y' au préalable

% Masses %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Each vertebrae masses are computed as a pourcentage of the trunk mass 
% ((Mass.Pelvis_Mass+Mass.LowerTrunk_Mass+Mass.Thorax_Mass) : Mass.UpperTrunk_Mass
% For dev-closed-loop branch :
% MassL1 = 5.7/100*(Mass.Pelvis_Mass+Mass.LowerTrunk_Mass+Mass.Thorax_Mass);
% MassL2 = 5.7/100*(Mass.Pelvis_Mass+Mass.LowerTrunk_Mass+Mass.Thorax_Mass);
% MassL3 = 5.7/100*(Mass.Pelvis_Mass+Mass.LowerTrunk_Mass+Mass.Thorax_Mass);
% MassL4 = 6.2/100*(Mass.Pelvis_Mass+Mass.LowerTrunk_Mass+Mass.Thorax_Mass);
% MassL5 = 6.3/100*(Mass.Pelvis_Mass+Mass.LowerTrunk_Mass+Mass.Thorax_Mass);
% For devMaster :
MassL1 = 5.7/100*(Mass.Pelvis_Mass+Mass.Trunk_Mass);
MassL2 = 5.7/100*(Mass.Pelvis_Mass+Mass.Trunk_Mass);
MassL3 = 5.7/100*(Mass.Pelvis_Mass+Mass.Trunk_Mass);
MassL4 = 6.2/100*(Mass.Pelvis_Mass+Mass.Trunk_Mass);
MassL5 = 6.3/100*(Mass.Pelvis_Mass+Mass.Trunk_Mass);

%Lombaires %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%L5
L5_SacrumJointNodeCT = M*k_new*[-4.3479 -78.4765 693.151]'*0.001 ;
L5_SacrumJointNode = pos_attachment_pt;
centroide_L5 = [0 norm(M*k_new*[-2.94559996 -87.24519983 701.76905394]'*0.001 - L5_SacrumJointNodeCT) 0]' ;% Repère local solide verticalisé
CoM_L5 = centroide_L5 + L5_length*[0.133	0.000	-0.007]'; %Données de Pearsal et al. traduites en pourcentage de la longueur du segment
CoM_L5CT = CoM_L5 + L5_SacrumJointNodeCT; %Repère segment parent
L5_L4JointNode = [0 norm(L5_L4CT - L5_SacrumJointNodeCT) 0]'; %Repère segment parent : on prend la longueur entre les deux joint node et on verticalise

%L4
centroide_L4 = [0 norm(M*k_new*[-2.39614997 -104.44660112 722.390606995]'*0.001 - L5_L4CT) 0]' ;% Repère local solide verticalisé
CoM_L4 = centroide_L4 + L4_length*[0.407	0.000	-0.005]';
CoM_L4CT = CoM_L4 + L5_L4CT;%Repère segment parent
L4_L3JointNode = [0 norm(L4_L3CT - L5_L4CT) 0]'; %Repère segment parent

%L3
centroide_L3 = [0 norm(M*k_new*[-1.429514095 -112.921062365 755.62319028]'*0.001 - L4_L3CT) 0]' ;% Repère local solide verticalisé
CoM_L3 = centroide_L3 + L3_length*[0.643	0.000	-0.002]';
CoM_L3CT = CoM_L3 + L4_L3CT;%Repère segment parent
L3_L2JointNode = [0 norm(L3_L2CT - L4_L3CT) 0]'; %Repère segment parent

%L2
centroide_L2 = [0 norm(M*k_new*[-0.8044241 -111.154867855 787.53803778]'*0.001 - L3_L2CT) 0]' ;% Repère local solide verticalisé
CoM_L2 = centroide_L2 + L2_length*[1.000	0.000	-0.004]';
CoM_L2CT = CoM_L2 + L3_L2CT;%Repère segment parent
L2_L1JointNode = [0 norm(L2_L1CT - L3_L2CT) 0]'; %Repère segment parent

%L1
centroide_L1 = [0 norm(M*k_new*[-0.9603 -104.424575345 820.410057905]'*0.001 - L2_L1CT) 0]' ;% Repère local solide verticalisé
CoM_L1 = centroide_L1 + L1_length*[1.250	0.000	-0.003]';
CoM_L1CT = CoM_L1 + L2_L1CT;%Repère segment parent
L1_ThoraxJointNode = [0 norm(L1_ThoraxCT - L2_L1CT) 0]'; %Repère segment parent
LowerTrunk_UpperTrunkNode = L1_ThoraxJointNode;

%% Définition des théta pour la posture de la colonne : %%%%%%%%

%% Takada
lordose = 49.4; % lordose de -44° supL1infL5 selon les valeurs de Yukawa et al. (2018)
lordose = lordose*pi/180;
sacrum_tilt = -41.5*pi/180; %Inclinaison du sacrum (=pelvis_incidence - pelvic_tilt)

theta_L5 = [0 0 sacrum_tilt        ]'; %Orientation du vecteur par rapport à l'axe z
% Répartitions de Bernhardt et al. (1989) :
theta_L4 = [0 0 0.45454545 *lordose]'; %Orientation du vecteur par rapport à l'axe z
theta_L3 = [0 0 0.29545455 *lordose]'; %Orientation du vecteur par rapport à l'axe z
theta_L2 = [0 0 0.15909091 *lordose]'; %Orientation du vecteur par rapport à l'axe z
theta_L1 = [0 0 0.09090909 *lordose]'; %Orientation du vecteur par rapport à l'axe z

%% Bruno dernière version
% theta_L5 = [0 0 -0.36652000000000001]'; %Orientation du vecteur par rapport à l'axe z
% theta_L4 = [0 0 0.31415999999999999]'; %Orientation du vecteur par rapport à l'axe z
% theta_L3 = [0 0 0.20943999999999999]'; %Orientation du vecteur par rapport à l'axe z
% theta_L2 = [0 0 0.12217]'; %Orientation du vecteur par rapport à l'axe z
% theta_L1 = [0 0 0.10471999999999999]'; %Orientation du vecteur par rapport à l'axe z


%% Definition of anatomical landmarks for the muscles and markers (wrt local RF on CoM)
%L5
L5_position_set = {...
    % Nodes (repère local)
    'L5_Origin', [0 0 0]'- CoM_L5;...
    'LowerTrunk_Origin', [0 0 0]'- CoM_L5;...
    'L5_L4Node', L5_L4JointNode- CoM_L5;...
    % Markers (repère global)
    'L5', M*k_new*[-7.401 -43.6654 712.458]'*0.001 - CoM_L5CT;...
    'L5POSSUP', M*k_new*[-3.61 -82.85 716.685]'*0.001 - CoM_L5CT;...
    % Muscle path 
    'Longissimus_thoracis_4o', M*k_new*[-0.008 -0.045 0.714]'- CoM_L5CT;...
    'Longissimus_thoracis_18o', M*k_new*[-0.008 -0.045 0.714]'- CoM_L5CT;...
    'Longissimus_thoracis_7i', M*k_new*[-0.037 -0.069 0.724]'- CoM_L5CT;...
    'Multifidus_1i', M*k_new*[-0.008 -0.046 0.708]'- CoM_L5CT;...
    'Multifidus_2i', M*k_new*[-0.010 -0.051 0.705]'- CoM_L5CT;...
    'Multifidus_7o', M*k_new*[-0.028 -0.053 0.699]'- CoM_L5CT;...
    'Multifidus_8o', M*k_new*[-0.035 -0.065 0.725]'- CoM_L5CT;...
    'Multifidus_13o', M*k_new*[-0.025 -0.055 0.699]'- CoM_L5CT;...
    % Via points
    'Iliocostalis_lumborum_1_via5', M*k_new*[-0.0594	-0.0770	0.7235]' - CoM_L5CT ;...
    'Iliocostalis_lumborum_2_via7', M*k_new*[-0.0555	-0.0770	0.7235]' - CoM_L5CT ;...
    'Iliocostalis_lumborum_3_via8', M*k_new*[-0.0517	-0.0770	0.7235]' - CoM_L5CT ;...
    'Iliocostalis_lumborum_4_via9', M*k_new*[-0.0490	-0.0770	0.7235]' - CoM_L5CT ;...
    'Iliocostalis_lumborum_5_via10', M*k_new*[-0.0472	-0.0770	0.7235]' - CoM_L5CT ;...
    'Iliocostalis_lumborum_6_via11', M*k_new*[-0.0447	-0.0768	0.7235]' - CoM_L5CT ;...
    'Longissimus_thoracis_2_via11', M*k_new*[-0.0105	-0.0445	0.7140]' - CoM_L5CT ;...
    'Longissimus_thoracis_3_via11', M*k_new*[-0.0111	-0.0445	0.7140]' - CoM_L5CT ;...
    'Longissimus_thoracis_5_via9', M*k_new*[-0.0127	-0.0445	0.7140]' - CoM_L5CT ;...
    'Longissimus_thoracis_6_via12', M*k_new*[-0.0105	-0.0445	0.7140]' - CoM_L5CT ;...
    'Longissimus_thoracis_12_via6', M*k_new*[-0.0369	-0.0445	0.7140]' - CoM_L5CT ;...
    'Longissimus_thoracis_13_via7', M*k_new*[-0.0358	-0.0445	0.7140]' - CoM_L5CT ;...
    'Longissimus_thoracis_14_via8', M*k_new*[-0.0265	-0.0445	0.7140]' - CoM_L5CT ;...
    'Longissimus_thoracis_15_via9', M*k_new*[-0.0096	-0.0445	0.7140]' - CoM_L5CT ;...
    'Longissimus_thoracis_16_via10', M*k_new*[-0.0098	-0.0445	0.7140]' - CoM_L5CT ;...
    'Longissimus_thoracis_17_via11', M*k_new*[-0.0092	-0.0445	0.7140]' - CoM_L5CT ;...
    'Psoas_major_2_via2', M*k_new*[-0.0510	-0.1290	0.6800]' - CoM_L5CT ;...
    'Psoas_major_3_via2', M*k_new*[-0.0573	-0.1262	0.6800]' - CoM_L5CT ;...
    'Psoas_major_4_via2', M*k_new*[-0.0523	-0.1215	0.6800]' - CoM_L5CT ;...
    'Psoas_major_5_via2', M*k_new*[-0.0577	-0.1300	0.6800]' - CoM_L5CT ;...
    'Psoas_major_6_via2', M*k_new*[-0.0585	-0.1328	0.6800]' - CoM_L5CT ;...
    'Psoas_major_7_via2', M*k_new*[-0.0600	-0.1360	0.6800]' - CoM_L5CT ;...
    'Psoas_major_8_via2', M*k_new*[-0.0513	-0.1310	0.6800]' - CoM_L5CT ;...
    'Psoas_major_9_via2', M*k_new*[-0.0560	-0.1365	0.6800]' - CoM_L5CT ;...
    'Psoas_major_10_via2', M*k_new*[-0.0565	-0.1370	0.6800]' - CoM_L5CT ;...
    % Muscle path left side
    'LLongissimus_thoracis_4o', S*(M*k_new*[-0.008 -0.045 0.714]'- CoM_L5CT);...
    'LLongissimus_thoracis_18o', S*(M*k_new*[-0.008 -0.045 0.714]'- CoM_L5CT);...
    'LLongissimus_thoracis_7i', S*(M*k_new*[-0.037 -0.069 0.724]'- CoM_L5CT);...
    'LMultifidus_1i', S*(M*k_new*[-0.008 -0.046 0.708]'- CoM_L5CT);...
    'LMultifidus_2i', S*(M*k_new*[-0.010 -0.051 0.705]'- CoM_L5CT);...
    'LMultifidus_7o', S*(M*k_new*[-0.028 -0.053 0.699]'- CoM_L5CT);...
    'LMultifidus_8o', S*(M*k_new*[-0.035 -0.065 0.725]'- CoM_L5CT);...
    'LMultifidus_13o', S*(M*k_new*[-0.025 -0.055 0.699]'- CoM_L5CT);...
    % Via points left side
    'LIliocostalis_lumborum_1_via5', S*(M*k_new*[-0.0594	-0.0770	0.7235]'- CoM_L5CT) ;...
    'LIliocostalis_lumborum_2_via7', S*(M*k_new*[-0.0555	-0.0770	0.7235]'- CoM_L5CT) ;...
    'LIliocostalis_lumborum_3_via8', S*(M*k_new*[-0.0517	-0.0770	0.7235]'- CoM_L5CT) ;...
    'LIliocostalis_lumborum_4_via9', S*(M*k_new*[-0.0490	-0.0770	0.7235]'- CoM_L5CT) ;...
    'LIliocostalis_lumborum_5_via10', S*(M*k_new*[-0.0472	-0.0770	0.7235]'- CoM_L5CT) ;...
    'LIliocostalis_lumborum_6_via11', S*(M*k_new*[-0.0447	-0.0768	0.7235]'- CoM_L5CT) ;...
    'LLongissimus_thoracis_2_via11', S*(M*k_new*[-0.0105	-0.0445	0.7140]'- CoM_L5CT) ;...
    'LLongissimus_thoracis_3_via11', S*(M*k_new*[-0.0111	-0.0445	0.7140]'- CoM_L5CT) ;...
    'LLongissimus_thoracis_5_via9', S*(M*k_new*[-0.0127	-0.0445	0.7140]'- CoM_L5CT) ;...
    'LLongissimus_thoracis_6_via12', S*(M*k_new*[-0.0105	-0.0445	0.7140]'- CoM_L5CT) ;...
    'LLongissimus_thoracis_12_via6', S*(M*k_new*[-0.0369	-0.0445	0.7140]'- CoM_L5CT) ;...
    'LLongissimus_thoracis_13_via7', S*(M*k_new*[-0.0358	-0.0445	0.7140]'- CoM_L5CT) ;...
    'LLongissimus_thoracis_14_via8', S*(M*k_new*[-0.0265	-0.0445	0.7140]'- CoM_L5CT) ;...
    'LLongissimus_thoracis_15_via9', S*(M*k_new*[-0.0096	-0.0445	0.7140]'- CoM_L5CT) ;...
    'LLongissimus_thoracis_16_via10', S*(M*k_new*[-0.0098	-0.0445	0.7140]'- CoM_L5CT) ;...
    'LLongissimus_thoracis_17_via11', S*(M*k_new*[-0.0092	-0.0445	0.7140]'- CoM_L5CT) ;...
    'LPsoas_major_2_via2', S*(M*k_new*[-0.0510	-0.1290	0.6800]'- CoM_L5CT) ;...
    'LPsoas_major_3_via2', S*(M*k_new*[-0.0573	-0.1262	0.6800]'- CoM_L5CT) ;...
    'LPsoas_major_4_via2', S*(M*k_new*[-0.0523	-0.1215	0.6800]'- CoM_L5CT) ;...
    'LPsoas_major_5_via2', S*(M*k_new*[-0.0577	-0.1300	0.6800]'- CoM_L5CT) ;...
    'LPsoas_major_6_via2', S*(M*k_new*[-0.0585	-0.1328	0.6800]'- CoM_L5CT) ;...
    'LPsoas_major_7_via2', S*(M*k_new*[-0.0600	-0.1360	0.6800]'- CoM_L5CT) ;...
    'LPsoas_major_8_via2', S*(M*k_new*[-0.0513	-0.1310	0.6800]'- CoM_L5CT) ;...
    'LPsoas_major_9_via2', S*(M*k_new*[-0.0560	-0.1365	0.6800]'- CoM_L5CT) ;...
    'LPsoas_major_10_via2', S*(M*k_new*[-0.0565	-0.1370	0.6800]'- CoM_L5CT) ...
    };
%L4
L4_position_set = {...
    % Nodes (repère local)
    'L4_Origin', [0 0 0]'- CoM_L4;...
    'L4_L3Node', L4_L3JointNode- CoM_L4;...
    % Markers (repère global)
    'L4', M*k_new*[-6.0543 -44.7147 735.105]'*0.001 - CoM_L4CT;...
    'L4POSSUP', M*k_new*[-2.76 -96.22 737.58]'*0.001 - CoM_L4CT;...
    % Muscle path 
    'Longissimus_thoracis_1o', M*k_new*[-0.007 -0.048 0.733]'- CoM_L4CT;...
    'Longissimus_thoracis_19o', M*k_new*[-0.007 -0.048 0.733]' - CoM_L4CT;...
    'Longissimus_thoracis_20o', M*k_new*[-0.008 -0.048 0.741]' - CoM_L4CT;...
    'Multifidus_11o', M*k_new*[-0.034 -0.08 0.741]' - CoM_L4CT;...
    'Multifidus_14o', M*k_new*[-0.032 -0.075 0.746]' - CoM_L4CT;...
    'Psoas_major_4o', M*k_new*[-0.033 -0.096 0.73]' - CoM_L4CT;...
    'Transversus_abdominus_3o', M*k_new*[-0.048 -0.083 0.739]' - CoM_L4CT;...
    'Longissimus_thoracis_8i', M*k_new*[-0.034 -0.078 0.74]' - CoM_L4CT;...
    'Multifidus_3i', M*k_new*[-0.007 -0.049 0.73]' - CoM_L4CT;...
    'Multifidus_4i', M*k_new*[-0.006 -0.054 0.728]' - CoM_L4CT;...
    'Multifidus_5i', M*k_new*[-0.008 -0.061 0.733]' - CoM_L4CT;...
    'Multifidus_16o', M*k_new*[-0.034 -0.08 0.7411]' - CoM_L4CT;...
    % Via points
    'Iliocostalis_lumborum_1_via4', M*k_new*[-0.0620	-0.0732	0.7387]' - CoM_L4CT ;...
    'Iliocostalis_lumborum_2_via6', M*k_new*[-0.0575	-0.0755	0.7387]' - CoM_L4CT ;...
    'Iliocostalis_lumborum_3_via7', M*k_new*[-0.0534	-0.0776	0.7387]' - CoM_L4CT ;...
    'Iliocostalis_lumborum_4_via8', M*k_new*[-0.0509	-0.0790	0.7387]' - CoM_L4CT ;...
    'Iliocostalis_lumborum_5_via9', M*k_new*[-0.0492	-0.0800	0.7387]' - CoM_L4CT ;...
    'Iliocostalis_lumborum_6_via10', M*k_new*[-0.0461	-0.0815	0.7387]' - CoM_L4CT ;...
    'Longissimus_thoracis_2_via10', M*k_new*[-0.0127	-0.0472	0.7329]' - CoM_L4CT ;...
    'Longissimus_thoracis_3_via10', M*k_new*[-0.0137	-0.0472	0.7329]' - CoM_L4CT ;...
    'Longissimus_thoracis_4_via12', M*k_new*[-0.0108	-0.0472	0.7329]' - CoM_L4CT ;...
    'Longissimus_thoracis_5_via8', M*k_new*[-0.0155	-0.0472	0.7329]' - CoM_L4CT ;...
    'Longissimus_thoracis_6_via11', M*k_new*[-0.0132	-0.0472	0.7329]' - CoM_L4CT ;...
    'Longissimus_thoracis_12_via5', M*k_new*[-0.0347	-0.0472	0.7329]' - CoM_L4CT ;...
    'Longissimus_thoracis_13_via6', M*k_new*[-0.0348	-0.0472	0.7329]' - CoM_L4CT ;...
    'Longissimus_thoracis_14_via7', M*k_new*[-0.0268	-0.0472	0.7329]' - CoM_L4CT ;...
    'Longissimus_thoracis_15_via8', M*k_new*[-0.0113	-0.0472	0.7329]' - CoM_L4CT ;...
    'Longissimus_thoracis_16_via9', M*k_new*[-0.0115	-0.0472	0.7329]' - CoM_L4CT ;...
    'Longissimus_thoracis_17_via10', M*k_new*[-0.0108	-0.0472	0.7329]' - CoM_L4CT ;...
    'Longissimus_thoracis_18_via11', M*k_new*[-0.0097	-0.0472	0.7329]' - CoM_L4CT ;...
    'Psoas_major_2_via3', M*k_new*[-0.0366	-0.1158	0.7150]' - CoM_L4CT ;...
    'Psoas_major_3_via3', M*k_new*[-0.0469	-0.1113	0.7150]' - CoM_L4CT ;...
    'Psoas_major_5_via3', M*k_new*[-0.0475	-0.1174	0.7150]' - CoM_L4CT ;...
    'Psoas_major_6_via3', M*k_new*[-0.0485	-0.1220	0.7150]' - CoM_L4CT ;...
    'Psoas_major_7_via3', M*k_new*[-0.0513	-0.1272	0.7150]' - CoM_L4CT ;...
    'Psoas_major_8_via3', M*k_new*[-0.0374	-0.1190	0.7150]' - CoM_L4CT ;...
    'Psoas_major_9_via3', M*k_new*[-0.0445	-0.1280	0.7150]' - CoM_L4CT ;...
    'Psoas_major_10_via3', M*k_new*[-0.0455	-0.1287	0.7150]' - CoM_L4CT ;...
    'Transversus_abdominis_2_via1', M*k_new*[-0.1156	-0.1596	0.7063]' - CoM_L4CT ;...
    'Transversus_abdominis_3_via1', M*k_new*[-0.0780	-0.0670	0.7450]' - CoM_L4CT ;...
    'Transversus_abdominis_3_via2', M*k_new*[-0.1052	-0.0925	0.7447]' - CoM_L4CT ;...
    'Transversus_abdominis_3_via4', M*k_new*[-0.1166	-0.1604	0.7175]' - CoM_L4CT ;...
    'Transversus_abdominis_4_via4', M*k_new*[-0.1176	-0.1612	0.7288]' - CoM_L4CT ;...
    % Muscle path left side
    'LLongissimus_thoracis_1o', S*(M*k_new*[-0.007 -0.048 0.733]'- CoM_L4CT);...
    'LLongissimus_thoracis_19o', S*(M*k_new*[-0.007 -0.048 0.733]' - CoM_L4CT);...
    'LLongissimus_thoracis_20o', S*(M*k_new*[-0.008 -0.048 0.741]' - CoM_L4CT);...
    'LMultifidus_11o', S*(M*k_new*[-0.034 -0.08 0.741]' - CoM_L4CT);...
    'LMultifidus_14o', S*(M*k_new*[-0.032 -0.075 0.746]' - CoM_L4CT);...
    'LPsoas_major_4o', S*(M*k_new*[-0.033 -0.096 0.73]' - CoM_L4CT);...
    'LTransversus_abdominus_3o', S*(M*k_new*[-0.048 -0.083 0.739]' - CoM_L4CT);...
    'LLongissimus_thoracis_8i', S*(M*k_new*[-0.034 -0.078 0.74]' - CoM_L4CT);...
    'LMultifidus_3i', S*(M*k_new*[-0.007 -0.049 0.73]' - CoM_L4CT);...
    'LMultifidus_4i', S*(M*k_new*[-0.006 -0.054 0.728]' - CoM_L4CT);...
    'LMultifidus_5i', S*(M*k_new*[-0.008 -0.061 0.733]' - CoM_L4CT);...
    'LMultifidus_16o', S*(M*k_new*[-0.034 -0.08 0.7411]' - CoM_L4CT);...
    % Via points left side
    'LIliocostalis_lumborum_1_via4', S*(M*k_new*[-0.0620	-0.0732	0.7387]' - CoM_L4CT) ;...
    'LIliocostalis_lumborum_2_via6', S*(M*k_new*[-0.0575	-0.0755	0.7387]' - CoM_L4CT) ;...
    'LIliocostalis_lumborum_3_via7', S*(M*k_new*[-0.0534	-0.0776	0.7387]' - CoM_L4CT) ;...
    'LIliocostalis_lumborum_4_via8', S*(M*k_new*[-0.0509	-0.0790	0.7387]' - CoM_L4CT) ;...
    'LIliocostalis_lumborum_5_via9', S*(M*k_new*[-0.0492	-0.0800	0.7387]' - CoM_L4CT) ;...
    'LIliocostalis_lumborum_6_via10', S*(M*k_new*[-0.0461	-0.0815	0.7387]' - CoM_L4CT) ;...
    'LLongissimus_thoracis_2_via10', S*(M*k_new*[-0.0127	-0.0472	0.7329]' - CoM_L4CT) ;...
    'LLongissimus_thoracis_3_via10', S*(M*k_new*[-0.0137	-0.0472	0.7329]' - CoM_L4CT) ;...
    'LLongissimus_thoracis_4_via12', S*(M*k_new*[-0.0108	-0.0472	0.7329]' - CoM_L4CT) ;...
    'LLongissimus_thoracis_5_via8', S*(M*k_new*[-0.0155	-0.0472	0.7329]' - CoM_L4CT) ;...
    'LLongissimus_thoracis_6_via11', S*(M*k_new*[-0.0132	-0.0472	0.7329]' - CoM_L4CT) ;...
    'LLongissimus_thoracis_12_via5', S*(M*k_new*[-0.0347	-0.0472	0.7329]' - CoM_L4CT) ;...
    'LLongissimus_thoracis_13_via6', S*(M*k_new*[-0.0348	-0.0472	0.7329]' - CoM_L4CT) ;...
    'LLongissimus_thoracis_14_via7', S*(M*k_new*[-0.0268	-0.0472	0.7329]' - CoM_L4CT) ;...
    'LLongissimus_thoracis_15_via8', S*(M*k_new*[-0.0113	-0.0472	0.7329]' - CoM_L4CT) ;...
    'LLongissimus_thoracis_16_via9', S*(M*k_new*[-0.0115	-0.0472	0.7329]' - CoM_L4CT) ;...
    'LLongissimus_thoracis_17_via10', S*(M*k_new*[-0.0108	-0.0472	0.7329]' - CoM_L4CT) ;...
    'LLongissimus_thoracis_18_via11', S*(M*k_new*[-0.0097	-0.0472	0.7329]' - CoM_L4CT) ;...
    'LPsoas_major_2_via3', S*(M*k_new*[-0.0366	-0.1158	0.7150]' - CoM_L4CT) ;...
    'LPsoas_major_3_via3', S*(M*k_new*[-0.0469	-0.1113	0.7150]' - CoM_L4CT) ;...
    'LPsoas_major_5_via3', S*(M*k_new*[-0.0475	-0.1174	0.7150]' - CoM_L4CT) ;...
    'LPsoas_major_6_via3', S*(M*k_new*[-0.0485	-0.1220	0.7150]' - CoM_L4CT) ;...
    'LPsoas_major_7_via3', S*(M*k_new*[-0.0513	-0.1272	0.7150]' - CoM_L4CT) ;...
    'LPsoas_major_8_via3', S*(M*k_new*[-0.0374	-0.1190	0.7150]' - CoM_L4CT) ;...
    'LPsoas_major_9_via3', S*(M*k_new*[-0.0445	-0.1280	0.7150]' - CoM_L4CT) ;...
    'LPsoas_major_10_via3', S*(M*k_new*[-0.0455	-0.1287	0.7150]' - CoM_L4CT) ;...
    'LTransversus_abdominis_2_via1', S*(M*k_new*[-0.1156	-0.1596	0.7063]' - CoM_L4CT) ;...
    'LTransversus_abdominis_3_via1', S*(M*k_new*[-0.0780	-0.0670	0.7450]' - CoM_L4CT) ;...
    'LTransversus_abdominis_3_via2', S*(M*k_new*[-0.1052	-0.0925	0.7447]' - CoM_L4CT) ;...
    'LTransversus_abdominis_3_via4', S*(M*k_new*[-0.1166	-0.1604	0.7175]' - CoM_L4CT) ;...
    'LTransversus_abdominis_4_via4', S*(M*k_new*[-0.1176	-0.1612	0.7288]' - CoM_L4CT) ...
    };

%L3
L3_position_set = {...
    % Nodes (repère local)
    'L3_Origin', [0 0 0]'- CoM_L3;...
    'L3_L2Node', L3_L2JointNode- CoM_L3;...
    % Markers (repère global)
    'L3', M*k_new*[-5.6219 -47.3227 755.98]'*0.001 - CoM_L3CT;...
    'L3POSSUP', M*k_new*[-1.285 -100.51 769.43]'*0.001 - CoM_L3CT;...
    % Muscle path 
    'Longissimus_thoracis_21o', M*k_new*[-0.009 -0.049 0.757]'- CoM_L3CT;...
    'Multifidus_15o', M*k_new*[-0.024 -0.084 0.774]'- CoM_L3CT;...
    'Psoas_major_2o', M*k_new*[-0.028 -0.108 0.736]'- CoM_L3CT;...
    'Psoas_major_3o', M*k_new*[-0.034 -0.092 0.76]'- CoM_L3CT;...
    'Psoas_major_8o', M*k_new*[-0.025 -0.109 0.746]'- CoM_L3CT;...
    'Quadratus_lumborum_5o', M*k_new*[-0.051 -0.082 0.761]'- CoM_L3CT;...
    'Transversus_abdominus_4o', M*k_new*[-0.045 -0.081 0.759]'- CoM_L3CT;...
    'Longissimus_thoracis_9i', M*k_new*[-0.026 -0.08 0.765]'- CoM_L3CT;...
    'Multifidus_6i', M*k_new*[-0.009 -0.051 0.749]'- CoM_L3CT;...
    'Multifidus_7i', M*k_new*[-0.01 -0.058 0.753]'- CoM_L3CT;...
    'Multifidus_8i', M*k_new*[-0.009 -0.066 0.753]'- CoM_L3CT;...
    'Quadratus_lumborum_1i', M*k_new*[-0.049 -0.083 0.756]'- CoM_L3CT;...
    'Quadratus_lumborum_6i', M*k_new*[-0.051 -0.083 0.759]'- CoM_L3CT;...
    'Multifidus_17o', M*k_new*[-0.024 -0.086 0.7673]'- CoM_L3CT;...
    % Via Points
    'Iliocostalis_lumborum_3_via6', M*k_new*[-0.0557	-0.0737	0.7589]' - CoM_L3CT ;...
    'Iliocostalis_lumborum_4_via7', M*k_new*[-0.0536	-0.0747	0.7589]' - CoM_L3CT ;...
    'Iliocostalis_lumborum_5_via8', M*k_new*[-0.0517	-0.0755	0.7589]' - CoM_L3CT ;...
    'Iliocostalis_lumborum_6_via9', M*k_new*[-0.0479	-0.0771	0.7589]' - CoM_L3CT ;...
    'Longissimus_thoracis_1_via13', M*k_new*[-0.0100	-0.0491	0.7572]' - CoM_L3CT ;...
    'Longissimus_thoracis_2_via9', M*k_new*[-0.0155	-0.0491	0.7572]' - CoM_L3CT ;...
    'Longissimus_thoracis_3_via9', M*k_new*[-0.0170	-0.0491	0.7572]' - CoM_L3CT ;...
    'Longissimus_thoracis_4_via11', M*k_new*[-0.0140	-0.0491	0.7572]' - CoM_L3CT ;...
    'Longissimus_thoracis_5_via7', M*k_new*[-0.0190	-0.0491	0.7572]' - CoM_L3CT ;...
    'Longissimus_thoracis_6_via10', M*k_new*[-0.0167	-0.0491	0.7572]' - CoM_L3CT ;...
    'Longissimus_thoracis_12_via4', M*k_new*[-0.0320	-0.0491	0.7572]' - CoM_L3CT ;...
    'Longissimus_thoracis_13_via5', M*k_new*[-0.0334	-0.0491	0.7572]' - CoM_L3CT ;...
    'Longissimus_thoracis_14_via6', M*k_new*[-0.0272	-0.0491	0.7572]' - CoM_L3CT ;...
    'Longissimus_thoracis_15_via7', M*k_new*[-0.0137	-0.0491	0.7572]' - CoM_L3CT ;...
    'Longissimus_thoracis_16_via8', M*k_new*[-0.0136	-0.0491	0.7572]' - CoM_L3CT ;...
    'Longissimus_thoracis_17_via9', M*k_new*[-0.0128	-0.0491	0.7572]' - CoM_L3CT ;...
    'Longissimus_thoracis_18_via10', M*k_new*[-0.0115	-0.0491	0.7572]' - CoM_L3CT ;...
    'Longissimus_thoracis_19_via11', M*k_new*[-0.0092	-0.0491	0.7572]' - CoM_L3CT ;...
    'Longissimus_thoracis_20_via12', M*k_new*[-0.0086	-0.0491	0.7572]' - CoM_L3CT ;...
    'Psoas_major_5_via4', M*k_new*[-0.0359	-0.1030	0.7550]' - CoM_L3CT ;...
    'Psoas_major_6_via4', M*k_new*[-0.0372	-0.1097	0.7550]' - CoM_L3CT ;...
    'Psoas_major_7_via4', M*k_new*[-0.0414	-0.1170	0.7550]' - CoM_L3CT ;...
    'Psoas_major_9_via4', M*k_new*[-0.0318	-0.1185	0.7550]' - CoM_L3CT ;...
    'Psoas_major_10_via4', M*k_new*[-0.0330	-0.1195	0.7550]' - CoM_L3CT ;...
    'Transversus_abdominis_3_via3', M*k_new*[-0.1157	-0.1100	0.7430]' - CoM_L3CT ;...
    'Transversus_abdominis_4_via1', M*k_new*[-0.0780	-0.0660	0.7620]' - CoM_L3CT ;...
    'Transversus_abdominis_4_via2', M*k_new*[-0.1052	-0.0925	0.7560]' - CoM_L3CT ;...
    'Transversus_abdominis_4_via3', M*k_new*[-0.1157	-0.1100	0.7524]' - CoM_L3CT ;...
    'Transversus_abdominis_5_via2', M*k_new*[-0.1052	-0.0925	0.7700]' - CoM_L3CT ;...
    'Transversus_abdominis_5_via3', M*k_new*[-0.1167	-0.1089	0.7602]' - CoM_L3CT ;...
    'Transversus_abdominis_5_via4', M*k_new*[-0.1186	-0.1619	0.7400]' - CoM_L3CT ;...
    'Transversus_abdominis_6_via3', M*k_new*[-0.1176	-0.1077	0.7679]' - CoM_L3CT ;...
    'Transversus_abdominis_6_via4', M*k_new*[-0.1196	-0.1627	0.7513]' - CoM_L3CT ;...
    'Transversus_abdominis_7_via1', M*k_new*[-0.1206	-0.1635	0.7625]' - CoM_L3CT ;...
    % Muscle path left side
    'LLongissimus_thoracis_21o', S*(M*k_new*[-0.009 -0.049 0.757]'- CoM_L3CT);...
    'LMultifidus_15o', S*(M*k_new*[-0.024 -0.084 0.774]'- CoM_L3CT);...
    'LPsoas_major_2o', S*(M*k_new*[-0.028 -0.108 0.736]'- CoM_L3CT);...
    'LPsoas_major_3o', S*(M*k_new*[-0.034 -0.092 0.76]'- CoM_L3CT);...
    'LPsoas_major_8o', S*(M*k_new*[-0.025 -0.109 0.746]'- CoM_L3CT);...
    'LQuadratus_lumborum_5o', S*(M*k_new*[-0.051 -0.082 0.761]'- CoM_L3CT);...
    'LTransversus_abdominus_4o', S*(M*k_new*[-0.045 -0.081 0.759]'- CoM_L3CT);...
    'LLongissimus_thoracis_9i', S*(M*k_new*[-0.026 -0.08 0.765]'- CoM_L3CT);...
    'LMultifidus_6i', S*(M*k_new*[-0.009 -0.051 0.749]'- CoM_L3CT);...
    'LMultifidus_7i', S*(M*k_new*[-0.01 -0.058 0.753]'- CoM_L3CT);...
    'LMultifidus_8i', S*(M*k_new*[-0.009 -0.066 0.753]'- CoM_L3CT);...
    'LQuadratus_lumborum_1i', S*(M*k_new*[-0.049 -0.083 0.756]'- CoM_L3CT);...
    'LQuadratus_lumborum_6i', S*(M*k_new*[-0.051 -0.083 0.759]'- CoM_L3CT);...
    'LMultifidus_17o', S*(M*k_new*[-0.024 -0.086 0.7673]'- CoM_L3CT);...
    % Via Points left side
    'LIliocostalis_lumborum_3_via6', S*(M*k_new*[-0.0557	-0.0737	0.7589]' - CoM_L3CT) ;...
    'LIliocostalis_lumborum_4_via7', S*(M*k_new*[-0.0536	-0.0747	0.7589]' - CoM_L3CT) ;...
    'LIliocostalis_lumborum_5_via8', S*(M*k_new*[-0.0517	-0.0755	0.7589]' - CoM_L3CT) ;...
    'LIliocostalis_lumborum_6_via9', S*(M*k_new*[-0.0479	-0.0771	0.7589]' - CoM_L3CT) ;...
    'LLongissimus_thoracis_1_via13', S*(M*k_new*[-0.0100	-0.0491	0.7572]' - CoM_L3CT) ;...
    'LLongissimus_thoracis_2_via9', S*(M*k_new*[-0.0155	-0.0491	0.7572]' - CoM_L3CT) ;...
    'LLongissimus_thoracis_3_via9', S*(M*k_new*[-0.0170	-0.0491	0.7572]' - CoM_L3CT) ;...
    'LLongissimus_thoracis_4_via11', S*(M*k_new*[-0.0140	-0.0491	0.7572]' - CoM_L3CT) ;...
    'LLongissimus_thoracis_5_via7', S*(M*k_new*[-0.0190	-0.0491	0.7572]' - CoM_L3CT) ;...
    'LLongissimus_thoracis_6_via10', S*(M*k_new*[-0.0167	-0.0491	0.7572]' - CoM_L3CT) ;...
    'LLongissimus_thoracis_12_via4', S*(M*k_new*[-0.0320	-0.0491	0.7572]' - CoM_L3CT) ;...
    'LLongissimus_thoracis_13_via5', S*(M*k_new*[-0.0334	-0.0491	0.7572]' - CoM_L3CT) ;...
    'LLongissimus_thoracis_14_via6', S*(M*k_new*[-0.0272	-0.0491	0.7572]' - CoM_L3CT) ;...
    'LLongissimus_thoracis_15_via7', S*(M*k_new*[-0.0137	-0.0491	0.7572]' - CoM_L3CT) ;...
    'LLongissimus_thoracis_16_via8', S*(M*k_new*[-0.0136	-0.0491	0.7572]' - CoM_L3CT) ;...
    'LLongissimus_thoracis_17_via9', S*(M*k_new*[-0.0128	-0.0491	0.7572]' - CoM_L3CT) ;...
    'LLongissimus_thoracis_18_via10', S*(M*k_new*[-0.0115	-0.0491	0.7572]' - CoM_L3CT) ;...
    'LLongissimus_thoracis_19_via11', S*(M*k_new*[-0.0092	-0.0491	0.7572]' - CoM_L3CT) ;...
    'LLongissimus_thoracis_20_via12', S*(M*k_new*[-0.0086	-0.0491	0.7572]' - CoM_L3CT) ;...
    'LPsoas_major_5_via4', S*(M*k_new*[-0.0359	-0.1030	0.7550]' - CoM_L3CT) ;...
    'LPsoas_major_6_via4', S*(M*k_new*[-0.0372	-0.1097	0.7550]' - CoM_L3CT) ;...
    'LPsoas_major_7_via4', S*(M*k_new*[-0.0414	-0.1170	0.7550]' - CoM_L3CT) ;...
    'LPsoas_major_9_via4', S*(M*k_new*[-0.0318	-0.1185	0.7550]' - CoM_L3CT) ;...
    'LPsoas_major_10_via4', S*(M*k_new*[-0.0330	-0.1195	0.7550]' - CoM_L3CT) ;...
    'LTransversus_abdominis_3_via3', S*(M*k_new*[-0.1157	-0.1100	0.7430]' - CoM_L3CT) ;...
    'LTransversus_abdominis_4_via1', S*(M*k_new*[-0.0780	-0.0660	0.7620]' - CoM_L3CT) ;...
    'LTransversus_abdominis_4_via2', S*(M*k_new*[-0.1052	-0.0925	0.7560]' - CoM_L3CT) ;...
    'LTransversus_abdominis_4_via3', S*(M*k_new*[-0.1157	-0.1100	0.7524]' - CoM_L3CT) ;...
    'LTransversus_abdominis_5_via2', S*(M*k_new*[-0.1052	-0.0925	0.7700]' - CoM_L3CT) ;...
    'LTransversus_abdominis_5_via3', S*(M*k_new*[-0.1167	-0.1089	0.7602]' - CoM_L3CT) ;...
    'LTransversus_abdominis_5_via4', S*(M*k_new*[-0.1186	-0.1619	0.7400]' - CoM_L3CT) ;...
    'LTransversus_abdominis_6_via3', S*(M*k_new*[-0.1176	-0.1077	0.7679]' - CoM_L3CT) ;...
    'LTransversus_abdominis_6_via4', S*(M*k_new*[-0.1196	-0.1627	0.7513]' - CoM_L3CT) ;...
    'LTransversus_abdominis_7_via1', S*(M*k_new*[-0.1206	-0.1635	0.7625]' - CoM_L3CT) ...
    };
%L2
L2_position_set = {...
    % Nodes (repère local)
    'L2_Origin', [0 0 0]'-CoM_L2;...
    'L2_L1Node', L2_L1JointNode-CoM_L2;...
    % Markers (repère global)
    'L2', M*k_new*[-2.4572 -45.6794 783.009]'*0.001 - CoM_L2CT;...
    'L2POSSUP', M*k_new*[-0.92 -96.455 798.92]'*0.001 - CoM_L2CT;...
    % Muscle path 
    'Latissimus_dorsi_2o', M*k_new*[-0.003 -0.046 0.777]'- CoM_L2CT;...
    'Longissimus_thoracis_22o', M*k_new*[-0.007 -0.048 0.777]'- CoM_L2CT;...
    'Psoas_major_5o', M*k_new*[-0.026 -0.091 0.789]'- CoM_L2CT;...
    'Psoas_major_9o', M*k_new*[-0.027 -0.115 0.77]'- CoM_L2CT;...
    'Psoas_major_10o', M*k_new*[-0.026 -0.114 0.778]'- CoM_L2CT;...
    'Transversus_abdominus_5o', M*k_new*[-0.046 -0.079 0.79]'- CoM_L2CT;...
    'Longissimus_thoracis_10i', M*k_new*[-0.025 -0.079 0.788]'- CoM_L2CT;...
    'Multifidus_9i', M*k_new*[-0.007 -0.05 0.773]'- CoM_L2CT;...
    'Multifidus_10i', M*k_new*[-0.007 -0.05 0.773]'- CoM_L2CT;...
    'Multifidus_11i', M*k_new*[-0.009 -0.07 0.776]'- CoM_L2CT;...
    'Quadratus_lumborum_2i', M*k_new*[-0.049 -0.079 0.789]'- CoM_L2CT;...
    'Quadratus_lumborum_3i', M*k_new*[-0.049 -0.08 0.789]'- CoM_L2CT;...
    'Quadratus_lumborum_7i', M*k_new*[-0.0491	-0.0799	0.789]'- CoM_L2CT;...
    'Multifidus_18o', M*k_new*[-0.025 -0.079 0.7874]'- CoM_L2CT;...
    % Via points
    'Iliocostalis_lumborum_1_via2',	M*k_new*[-0.0695	-0.0647	0.7875]' - CoM_L2CT ;...
    'Iliocostalis_lumborum_2_via4',	M*k_new*[-0.0638	-0.0675	0.7875]' - CoM_L2CT ;...
    'Iliocostalis_lumborum_3_via5',	M*k_new*[-0.0590	-0.0700	0.7875]' - CoM_L2CT ;...
    'Iliocostalis_lumborum_4_via6',	M*k_new*[-0.0573	-0.0709	0.7875]' - CoM_L2CT ;...
    'Iliocostalis_lumborum_5_via7',	M*k_new*[-0.0554	-0.0719	0.7875]' - CoM_L2CT ;...
    'Iliocostalis_lumborum_6_via8',	M*k_new*[-0.0505	-0.0743	0.7875]' - CoM_L2CT ;...
    'Longissimus_thoracis_1_via12',	M*k_new*[-0.0122	-0.0481	0.7772]' - CoM_L2CT ;...
    'Longissimus_thoracis_2_via8',	M*k_new*[-0.0178	-0.0481	0.7772]' - CoM_L2CT ;...
    'Longissimus_thoracis_3_via8',	M*k_new*[-0.0198	-0.0481	0.7772]' - CoM_L2CT ;...
    'Longissimus_thoracis_4_via10',	M*k_new*[-0.0165	-0.0481	0.7772]' - CoM_L2CT ;...
    'Longissimus_thoracis_5_via6',	M*k_new*[-0.0220	-0.0481	0.7772]' - CoM_L2CT ;...
    'Longissimus_thoracis_6_via9',	M*k_new*[-0.0195	-0.0481	0.7772]' - CoM_L2CT ;...
    'Longissimus_thoracis_12_via3',	M*k_new*[-0.0297	-0.0481	0.7772]' - CoM_L2CT ;...
    'Longissimus_thoracis_13_via4',	M*k_new*[-0.0323	-0.0481	0.7772]' - CoM_L2CT ;...
    'Longissimus_thoracis_14_via5',	M*k_new*[-0.0276	-0.0481	0.7772]' - CoM_L2CT ;...
    'Longissimus_thoracis_15_via6',	M*k_new*[-0.0155	-0.0481	0.7772]' - CoM_L2CT ;...
    'Longissimus_thoracis_16_via7',	M*k_new*[-0.0153	-0.0481	0.7772]' - CoM_L2CT ;...
    'Longissimus_thoracis_17_via8',	M*k_new*[-0.0145	-0.0481	0.7772]' - CoM_L2CT ;...
    'Longissimus_thoracis_18_via9',	M*k_new*[-0.0132	-0.0481	0.7772]' - CoM_L2CT ;...
    'Longissimus_thoracis_19_via10',	M*k_new*[-0.0110	-0.0481	0.7772]' - CoM_L2CT ;...
    'Longissimus_thoracis_20_via11',	M*k_new*[-0.0100	-0.0481	0.7772]' - CoM_L2CT ;...
    'Longissimus_thoracis_21_via11',	M*k_new*[-0.0096	-0.0481	0.7772]' - CoM_L2CT ;...
    'Psoas_major_6_via5',	M*k_new*[-0.0283	-0.0998	0.7870]' - CoM_L2CT ;...
    'Psoas_major_7_via5',	M*k_new*[-0.0334	-0.1088	0.7870]' - CoM_L2CT ;...
    'Transversus_abdominis_5_via1',	M*k_new*[-0.0780	-0.0630	0.7880]' - CoM_L2CT ;...
    'Transversus_abdominis_6_via2',	M*k_new*[-0.1052	-0.0925	0.7850]' - CoM_L2CT ;...
    % Muscle path left side
    'LLatissimus_dorsi_2o', S*(M*k_new*[-0.003 -0.046 0.777]'- CoM_L2CT);...
    'LLongissimus_thoracis_22o', S*(M*k_new*[-0.007 -0.048 0.777]'- CoM_L2CT);...
    'LPsoas_major_5o', S*(M*k_new*[-0.026 -0.091 0.789]'- CoM_L2CT);...
    'LPsoas_major_9o', S*(M*k_new*[-0.027 -0.115 0.77]'- CoM_L2CT);...
    'LPsoas_major_10o', S*(M*k_new*[-0.026 -0.114 0.778]'- CoM_L2CT);...
    'LTransversus_abdominus_5o', S*(M*k_new*[-0.046 -0.079 0.79]'- CoM_L2CT);...
    'LLongissimus_thoracis_10i', S*(M*k_new*[-0.025 -0.079 0.788]'- CoM_L2CT);...
    'LMultifidus_9i', S*(M*k_new*[-0.007 -0.05 0.773]'- CoM_L2CT);...
    'LMultifidus_10i', S*(M*k_new*[-0.007 -0.05 0.773]'- CoM_L2CT);...
    'LMultifidus_11i', S*(M*k_new*[-0.009 -0.07 0.776]'- CoM_L2CT);...
    'LQuadratus_lumborum_2i', S*(M*k_new*[-0.049 -0.079 0.789]'- CoM_L2CT);...
    'LQuadratus_lumborum_3i', S*(M*k_new*[-0.049 -0.08 0.789]'- CoM_L2CT);...
    'LMultifidus_18o', S*(M*k_new*[-0.025 -0.079 0.7874]'- CoM_L2CT);...
    % Via points left side
    'LIliocostalis_lumborum_1_via2', S*(M*k_new*[-0.0695	-0.0647	0.7875]' - CoM_L2CT) ;...
    'LIliocostalis_lumborum_2_via4', S*(M*k_new*[-0.0638	-0.0675	0.7875]' - CoM_L2CT) ;...
    'LIliocostalis_lumborum_3_via5', S*(M*k_new*[-0.0590	-0.0700	0.7875]' - CoM_L2CT) ;...
    'LIliocostalis_lumborum_4_via6', S*(M*k_new*[-0.0573	-0.0709	0.7875]' - CoM_L2CT) ;...
    'LIliocostalis_lumborum_5_via7', S*(M*k_new*[-0.0554	-0.0719	0.7875]' - CoM_L2CT) ;...
    'LIliocostalis_lumborum_6_via8', S*(M*k_new*[-0.0505	-0.0743	0.7875]' - CoM_L2CT) ;...
    'LLongissimus_thoracis_1_via12', S*(M*k_new*[-0.0122	-0.0481	0.7772]' - CoM_L2CT) ;...
    'LLongissimus_thoracis_2_via8', S*(M*k_new*[-0.0178	-0.0481	0.7772]' - CoM_L2CT) ;...
    'LLongissimus_thoracis_3_via8', S*(M*k_new*[-0.0198	-0.0481	0.7772]' - CoM_L2CT) ;...
    'LLongissimus_thoracis_4_via10', S*(M*k_new*[-0.0165	-0.0481	0.7772]' - CoM_L2CT) ;...
    'LLongissimus_thoracis_5_via6', S*(M*k_new*[-0.0220	-0.0481	0.7772]' - CoM_L2CT) ;...
    'LLongissimus_thoracis_6_via9', S*(M*k_new*[-0.0195	-0.0481	0.7772]' - CoM_L2CT) ;...
    'LLongissimus_thoracis_12_via3', S*(M*k_new*[-0.0297	-0.0481	0.7772]' - CoM_L2CT) ;...
    'LLongissimus_thoracis_13_via4', S*(M*k_new*[-0.0323	-0.0481	0.7772]' - CoM_L2CT) ;...
    'LLongissimus_thoracis_14_via5', S*(M*k_new*[-0.0276	-0.0481	0.7772]' - CoM_L2CT) ;...
    'LLongissimus_thoracis_15_via6', S*(M*k_new*[-0.0155	-0.0481	0.7772]' - CoM_L2CT) ;...
    'LLongissimus_thoracis_16_via7', S*(M*k_new*[-0.0153	-0.0481	0.7772]' - CoM_L2CT) ;...
    'LLongissimus_thoracis_17_via8', S*(M*k_new*[-0.0145	-0.0481	0.7772]' - CoM_L2CT) ;...
    'LLongissimus_thoracis_18_via9', S*(M*k_new*[-0.0132	-0.0481	0.7772]' - CoM_L2CT) ;...
    'LLongissimus_thoracis_19_via10', S*(M*k_new*[-0.0110	-0.0481	0.7772]' - CoM_L2CT) ;...
    'LLongissimus_thoracis_20_via11', S*(M*k_new*[-0.0100	-0.0481	0.7772]' - CoM_L2CT) ;...
    'LLongissimus_thoracis_21_via11', S*(M*k_new*[-0.0096	-0.0481	0.7772]' - CoM_L2CT) ;...
    'LPsoas_major_6_via5', S*(M*k_new*[-0.0283	-0.0998	0.7870]' - CoM_L2CT) ;...
    'LPsoas_major_7_via5', S*(M*k_new*[-0.0334	-0.1088	0.7870]' - CoM_L2CT) ;...
    'LTransversus_abdominis_5_via1', S*(M*k_new*[-0.0780	-0.0630	0.7880]' - CoM_L2CT) ;...
    'LTransversus_abdominis_6_via2', S*(M*k_new*[-0.1052	-0.0925	0.7850]' - CoM_L2CT) ...
    };
%L1
L1_position_set = {...
    % Nodes (repère local)
    'L1_Origin', [0 0 0]'-CoM_L1;...
    'L1_ThoraxNode', L1_ThoraxJointNode-CoM_L1;...
    'LowerTrunk_UpperTrunkNode', LowerTrunk_UpperTrunkNode-CoM_L1;...
    % Markers (repère global)
    'L1', M*k_new*[-2.5172 -42.221 806.416]'*0.001 - CoM_L1CT;...
    'L1POSSUP', M*k_new*[-1.825 -88.905 829.855]'*0.001 - CoM_L1CT;...
    % Muscle path 
    'Longissimus_thoracis_23o', M*k_new*[-0.006 -0.046 0.801]'- CoM_L1CT;...
    'Psoas_major_6o', M*k_new*[-0.019 -0.09 0.82]'- CoM_L1CT;...
    'Psoas_major_6o', M*k_new*[-0.023 -0.098 0.829]'- CoM_L1CT;...
    'Serratus_posterior_inferior_1o', M*k_new*[-0.005 -0.045 0.8]'- CoM_L1CT;...
    'Transversus_abdominus_6o', M*k_new*[-0.04 -0.075 0.824]' - CoM_L1CT;...
    'Longissimus_thoracis_11i', M*k_new*[-0.024 -0.07 0.816]'- CoM_L1CT;...
    'Multifidus_12i', M*k_new*[-0.005 -0.05 0.798]' - CoM_L1CT;...
    'Multifidus_13i', M*k_new*[-0.005 -0.049 0.798]' - CoM_L1CT;...
    'Multifidus_14i', M*k_new*[-0.004 -0.055 0.797]' - CoM_L1CT;...
    'Multifidus_15i', M*k_new*[-0.006 -0.064 0.802]' - CoM_L1CT;...
    'Quadratus_lumborum_4i', M*k_new*[-0.043 -0.076 0.821]' - CoM_L1CT;...
    'Multifidus_19o', M*k_new*[-0.025 -0.071 0.8155]' - CoM_L1CT;...
    'Multifidus_20o', M*k_new*[-0.025 -0.071 0.8152]' - CoM_L1CT;...
    'Multifidus_21o', M*k_new*[-0.025 -0.071 0.8152]' - CoM_L1CT;...
    'Spinalis_thoracis_3o', M*k_new*[-0.008 -0.046 0.81]' - CoM_L1CT;...
    'Spinalis_thoracis_4o', M*k_new*[-0.008 -0.046 0.81]' - CoM_L1CT;...
    'Spinalis_thoracis_5o', M*k_new*[-0.008 -0.046 0.81]' - CoM_L1CT;...
    % Via points
    'Iliocostalis_lumborum_1_via1'	,M*k_new*[-0.0747	-0.0593	0.8211]' - CoM_L1CT ;...
    'Iliocostalis_lumborum_2_via3'	,M*k_new*[-0.0682	-0.0616	0.8211]' - CoM_L1CT ;...
    'Iliocostalis_lumborum_3_via4'	,M*k_new*[-0.0627	-0.0636	0.8211]' - CoM_L1CT ;...
    'Iliocostalis_lumborum_4_via5'	,M*k_new*[-0.0616	-0.0640	0.8211]' - CoM_L1CT ;...
    'Iliocostalis_lumborum_5_via6'	,M*k_new*[-0.0597	-0.0647	0.8211]' - CoM_L1CT ;...
    'Iliocostalis_lumborum_6_via7'	,M*k_new*[-0.0535	-0.0672	0.8211]' - CoM_L1CT ;...
    'Longissimus_thoracis_1_via11'	,M*k_new*[-0.0151	-0.0463	0.8014]' - CoM_L1CT ;...
    'Longissimus_thoracis_2_via7'	,M*k_new*[-0.0205	-0.0463	0.8014]' - CoM_L1CT ;...
    'Longissimus_thoracis_3_via7'	,M*k_new*[-0.0230	-0.0463	0.8014]' - CoM_L1CT ;...
    'Longissimus_thoracis_4_via9'	,M*k_new*[-0.0198	-0.0463	0.8014]' - CoM_L1CT ;...
    'Longissimus_thoracis_5_via5'	,M*k_new*[-0.0255	-0.0463	0.8014]' - CoM_L1CT ;...
    'Longissimus_thoracis_6_via8'	,M*k_new*[-0.0230	-0.0463	0.8014]' - CoM_L1CT ;...
    'Longissimus_thoracis_12_via2'	,M*k_new*[-0.0270	-0.0463	0.8014]' - CoM_L1CT ;...
    'Longissimus_thoracis_13_via3'	,M*k_new*[-0.0310	-0.0463	0.8014]' - CoM_L1CT ;...
    'Longissimus_thoracis_14_via4'	,M*k_new*[-0.0278	-0.0463	0.8014]' - CoM_L1CT ;...
    'Longissimus_thoracis_15_via5'	,M*k_new*[-0.0179	-0.0463	0.8014]' - CoM_L1CT ;...
    'Longissimus_thoracis_16_via6'	,M*k_new*[-0.0175	-0.0463	0.8014]' - CoM_L1CT ;...
    'Longissimus_thoracis_17_via7'	,M*k_new*[-0.0165	-0.0463	0.8014]' - CoM_L1CT ;...
    'Longissimus_thoracis_18_via8'	,M*k_new*[-0.0152	-0.0463	0.8014]' - CoM_L1CT ;...
    'Longissimus_thoracis_19_via9'	,M*k_new*[-0.0132	-0.0463	0.8014]' - CoM_L1CT ;...
    'Longissimus_thoracis_20_via10'	,M*k_new*[-0.0115	-0.0463	0.8014]' - CoM_L1CT ;...
    'Longissimus_thoracis_21_via10'	,M*k_new*[-0.0108	-0.0463	0.8014]' - CoM_L1CT ;...
    'Longissimus_thoracis_22_via11'	,M*k_new*[-0.0083	-0.0463	0.8014]' - CoM_L1CT ;...
    'Transversus_abdominis_6_via1'	,M*k_new*[-0.0780	-0.0610	0.8160]' - CoM_L1CT ;...
    % Muscle path left side
    'LLongissimus_thoracis_23o', S*(M*k_new*[-0.006 -0.046 0.801]'- CoM_L1CT);...
    'LPsoas_major_6o', S*(M*k_new*[-0.019 -0.09 0.82]'- CoM_L1CT);...
    'LPsoas_major_6o', S*(M*k_new*[-0.023 -0.098 0.829]'- CoM_L1CT);...
    'LSerratus_posterior_inferior_1o', S*(M*k_new*[-0.005 -0.045 0.8]'- CoM_L1CT);...
    'LTransversus_abdominus_6o', S*(M*k_new*[-0.04 -0.075 0.824]' - CoM_L1CT);...
    'LLongissimus_thoracis_11i', S*(M*k_new*[-0.024 -0.07 0.816]'- CoM_L1CT);...
    'LMultifidus_13i', S*(M*k_new*[-0.005 -0.05 0.798]' - CoM_L1CT);...
    'LMultifidus_14i', S*(M*k_new*[-0.004 -0.055 0.797]' - CoM_L1CT);...
    'LMultifidus_15i', S*(M*k_new*[-0.006 -0.064 0.802]' - CoM_L1CT);...
    'LQuadratus_lumborum_4i', S*(M*k_new*[-0.043 -0.076 0.821]' - CoM_L1CT);...
    'LMultifidus_19o', S*(M*k_new*[-0.025 -0.071 0.8155]' - CoM_L1CT);...
    'LMultifidus_20o', S*(M*k_new*[-0.025 -0.071 0.8152]' - CoM_L1CT);...
    'LMultifidus_21o', S*(M*k_new*[-0.025 -0.071 0.8152]' - CoM_L1CT);...
    'LSpinalis_thoracis_3o', S*(M*k_new*[-0.008 -0.046 0.81]' - CoM_L1CT);...
    'LSpinalis_thoracis_4o', S*(M*k_new*[-0.008 -0.046 0.81]' - CoM_L1CT);...
    'LSpinalis_thoracis_5o', S*(M*k_new*[-0.008 -0.046 0.81]' - CoM_L1CT);...
    % Via points left side
    'LIliocostalis_lumborum_1_via1'	,S*(M*k_new*[-0.0747	-0.0593	0.8211]' - CoM_L1CT) ;...
    'LIliocostalis_lumborum_2_via3'	,S*(M*k_new*[-0.0682	-0.0616	0.8211]' - CoM_L1CT) ;...
    'LIliocostalis_lumborum_3_via4'	,S*(M*k_new*[-0.0627	-0.0636	0.8211]' - CoM_L1CT) ;...
    'LIliocostalis_lumborum_4_via5'	,S*(M*k_new*[-0.0616	-0.0640	0.8211]' - CoM_L1CT) ;...
    'LIliocostalis_lumborum_5_via6'	,S*(M*k_new*[-0.0597	-0.0647	0.8211]' - CoM_L1CT) ;...
    'LIliocostalis_lumborum_6_via7'	,S*(M*k_new*[-0.0535	-0.0672	0.8211]' - CoM_L1CT) ;...
    'LLongissimus_thoracis_1_via11'	,S*(M*k_new*[-0.0151	-0.0463	0.8014]' - CoM_L1CT) ;...
    'LLongissimus_thoracis_2_via7'	,S*(M*k_new*[-0.0205	-0.0463	0.8014]' - CoM_L1CT) ;...
    'LLongissimus_thoracis_3_via7'	,S*(M*k_new*[-0.0230	-0.0463	0.8014]' - CoM_L1CT) ;...
    'LLongissimus_thoracis_4_via9'	,S*(M*k_new*[-0.0198	-0.0463	0.8014]' - CoM_L1CT) ;...
    'LLongissimus_thoracis_5_via5'	,S*(M*k_new*[-0.0255	-0.0463	0.8014]' - CoM_L1CT) ;...
    'LLongissimus_thoracis_6_via8'	,S*(M*k_new*[-0.0230	-0.0463	0.8014]' - CoM_L1CT) ;...
    'LLongissimus_thoracis_12_via2'	,S*(M*k_new*[-0.0270	-0.0463	0.8014]' - CoM_L1CT) ;...
    'LLongissimus_thoracis_13_via3'	,S*(M*k_new*[-0.0310	-0.0463	0.8014]' - CoM_L1CT) ;...
    'LLongissimus_thoracis_14_via4'	,S*(M*k_new*[-0.0278	-0.0463	0.8014]' - CoM_L1CT) ;...
    'LLongissimus_thoracis_15_via5'	,S*(M*k_new*[-0.0179	-0.0463	0.8014]' - CoM_L1CT) ;...
    'LLongissimus_thoracis_16_via6'	,S*(M*k_new*[-0.0175	-0.0463	0.8014]' - CoM_L1CT) ;...
    'LLongissimus_thoracis_17_via7'	,S*(M*k_new*[-0.0165	-0.0463	0.8014]' - CoM_L1CT) ;...
    'LLongissimus_thoracis_18_via8'	,S*(M*k_new*[-0.0152	-0.0463	0.8014]' - CoM_L1CT) ;...
    'LLongissimus_thoracis_19_via9'	,S*(M*k_new*[-0.0132	-0.0463	0.8014]' - CoM_L1CT) ;...
    'LLongissimus_thoracis_20_via10'	,S*(M*k_new*[-0.0115	-0.0463	0.8014]' - CoM_L1CT) ;...
    'LLongissimus_thoracis_21_via10'	,S*(M*k_new*[-0.0108	-0.0463	0.8014]' - CoM_L1CT) ;...
    'LLongissimus_thoracis_22_via11'	,S*(M*k_new*[-0.0083	-0.0463	0.8014]' - CoM_L1CT) ;...
    'LTransversus_abdominis_6_via1'	,S*(M*k_new*[-0.0780	-0.0610	0.8160]' - CoM_L1CT) ...
    };

%%                     Scaling inertial parameters
% From "Segmental Inertial Parameters of the Human Trunk as Determined from
% Computed Tomography", Pearsall et al. (1996)

%Each vertebrae Inertia matrix at the CoM :

IL1 = [64.0    0    0 ;...
          0 111.3    0 ;...
          0    0 175.3]/10000;
IL2 = [59.1    0    0 ;...
          0 109.1    0 ;...
          0    0 168.2]/10000;
IL3 = [54.1    0    0 ;...
          0 106.6    0 ;...
          0    0 160.8]/10000;
IL4 = [52.0    0    0 ;...
          0 112.3    0 ;...
          0    0 164.3]/10000;
IL5 = [54.6    0    0 ;...
          0 121.9    0 ;...
          0    0 176.5]/10000;

%% Equations for kinematic constrains

% Explication :
% Les 3 angles (FE/LB/AR) au niveau de L5S1 sont libres mais doivent rester
% dans les limites physiologiques. De même pour les angles au niveau de
% T12/L1. Les angles de FE et de AR sont libres au niveau de T8/T9 et en LB
% au niveau de T4/T5.
% On a dans le cas de la FE (resp. AR) :
% Dans ce cas (9ddl) :
% ThetaS1L1 = ThetaL5S1/ContribL5S1(%) donc les 
% Theta,i = (Contrib,i/ContribL5S1)*ThetaL5S1
% ThetaL1T9 = ThetaT12L1/ContribT12L1(%) donc les 
% Theta,j = (Contrib,j/ContribT12L1)*ThetaT12L1
% ThetaT9T1 = ThetaT8T9/ContribT8T9(%) donc les
% Theta,k = (Contrib,k/ContribT8T9)*ThetaT8T9
% Pour le cas de la LB
% ThetaS1L1 = ThetaL5S1/ContribL5S1(%) donc les 
% Theta,i = (Contrib,i/ContribL5S1)*ThetaL5S1
% ThetaL1T5 = ThetaT12L1/ContribT12L1(%) donc les 
% Theta,j = (Contrib,j/ContribT12L1)*ThetaT12L1
% ThetaT5T1 = ThetaT4T5/ContribT4T5(%) donc les
% Theta,k = (Contrib,k/ContribT4T5)*ThetaT4T5

%{
L5S1_FE = 0.15; L5S1_LB = 0.09 ; L5S1_AR = 0.04;
L4L5_FE = 0.18/L5S1_FE; L4L5_LB = 0.20/L5S1_LB ; L4L5_AR = 0.04/L5S1_AR;
L3L4_FE = 0.17/L5S1_FE; L3L4_LB = 0.26/L5S1_LB ; L3L4_AR = 0.04/L5S1_AR;
L2L3_FE = 0.19/L5S1_FE; L2L3_LB = 0.25/L5S1_LB ; L2L3_AR = 0.04/L5S1_AR;
L1L2_FE = 0.14/L5S1_FE; L1L2_LB = 0.20/L5S1_LB ; L1L2_AR = 0.04/L5S1_AR;
%}


                    %% %% "Human_model" structure generation

num_solid = 0;
%% Lower Trunk

    % L5_J1 %Flexion-Extension
    num_solid=num_solid+1;                        % number of the solid ...
    name=list_solid{num_solid};                                % solid name
    eval(['incr_solid=s_' name ';'])     % number of the solid in the model
    OsteoArticularModel(incr_solid).name=name;                 % solid name
    OsteoArticularModel(incr_solid).sister=0;                
    OsteoArticularModel(incr_solid).child=s_L5_J2;                   
    OsteoArticularModel(incr_solid).mother=s_mother;           
    OsteoArticularModel(incr_solid).a=[0 0 1]'; %Flexion-Extension
    OsteoArticularModel(incr_solid).joint=1;  
    OsteoArticularModel(incr_solid).limit_sup= 1.5*(7.22+5.9250) *(2*pi/360); %Degrees to rad conversion (from White et Punjabi + René Louis proportion) and coef. 1.5
    OsteoArticularModel(incr_solid).limit_inf= 1.5*(-12.77+5.9250) *(2*pi/360); %Degrees to rad conversion
    % OsteoArticularModel(incr_solid).limit_sup= 6.51 *(2*pi/360); %Degrees to rad conversion (from René Louis)
    % OsteoArticularModel(incr_solid).limit_inf= -11.49 *(2*pi/360); %Degrees to rad conversion
    OsteoArticularModel(incr_solid).Visual=0;
    OsteoArticularModel(incr_solid).b=L5_SacrumJointNode;
    OsteoArticularModel(incr_solid).c=[0 0 0]';
    OsteoArticularModel(incr_solid).m=0;                 
    OsteoArticularModel(incr_solid).I=zeros(3,3);

    % L5_J2 %Lateral-Bending
    num_solid=num_solid+1;                        % number of the solid ...
    name=list_solid{num_solid};                                % solid name
    eval(['incr_solid=s_' name ';'])     % number of the solid in the model
    OsteoArticularModel(incr_solid).name=name;                 % solid name
    OsteoArticularModel(incr_solid).sister=0;                
    OsteoArticularModel(incr_solid).child=s_L5;                   
    OsteoArticularModel(incr_solid).mother=s_L5_J1;           
    OsteoArticularModel(incr_solid).a=[0 0 0]'; %Lateral-Bending
    OsteoArticularModel(incr_solid).joint=1;
    OsteoArticularModel(incr_solid).limit_sup= 1.5*(3-0.0799) *(2*pi/360); %Degrees to rad conversion (from White and Punjabi value for L4/L5) with coef.1.5
    OsteoArticularModel(incr_solid).limit_inf= 1.5*(-3-0.0799) *(2*pi/360); %Degrees to rad conversion
    % OsteoArticularModel(incr_solid).limit_inf= -5 *(2*pi/360);
    % OsteoArticularModel(incr_solid).limit_sup= 5 *(2*pi/360);
    % OsteoArticularModel(incr_solid).limit_sup= inf;
    % OsteoArticularModel(incr_solid).limit_inf= -inf;
    OsteoArticularModel(incr_solid).Visual=0;
    OsteoArticularModel(incr_solid).b=[0 0 0]';
    OsteoArticularModel(incr_solid).c=[0 0 0]';
    OsteoArticularModel(incr_solid).m=0;                 
    OsteoArticularModel(incr_solid).I=zeros(3,3);

    % L5 % Axial-rotation
    num_solid=num_solid+1;                        % number of the solid ...
    name=list_solid{num_solid};                                % solid name
    eval(['incr_solid=s_' name ';'])     % number of the solid in the model
    OsteoArticularModel(incr_solid).name=name;                 % solid name
    OsteoArticularModel(incr_solid).sister=0;                
    OsteoArticularModel(incr_solid).child=s_L4_J1;                   
    OsteoArticularModel(incr_solid).mother=s_L5_J2;           
    OsteoArticularModel(incr_solid).a=[0 0 0]'; % Axial-rotation
    OsteoArticularModel(incr_solid).joint=1; 
    OsteoArticularModel(incr_solid).limit_sup= 2*(2.5-0.7249) *(2*pi/360); %Degrees to rad conversion (from White et Punjabi + René Louis proportion and coef. x2)
    OsteoArticularModel(incr_solid).limit_inf= 2*(-2.5-0.7249) *(2*pi/360); %Degrees to rad conversion
    % OsteoArticularModel(incr_solid).limit_inf= -2*(2*pi/360);
    % OsteoArticularModel(incr_solid).limit_sup=  2*(2*pi/360);
    % OsteoArticularModel(incr_solid).limit_sup= inf;
    % OsteoArticularModel(incr_solid).limit_inf= -inf;
    % OsteoArticularModel(incr_solid).calib_k_constraint = num_solid+4; %Same homothetic coeff.
    OsteoArticularModel(incr_solid).Visual=1;
    OsteoArticularModel(incr_solid).b=[0 0 0]';
    OsteoArticularModel(incr_solid).c=CoM_L5;
    OsteoArticularModel(incr_solid).m=MassL5;                         
    OsteoArticularModel(incr_solid).I=IL5; 
    OsteoArticularModel(incr_solid).anat_position=L5_position_set;
    OsteoArticularModel(incr_solid).L={'LowerTrunk_Origin';'L5_L4JointNode'};
    OsteoArticularModel(incr_solid).visual_file = ['Twente/L5.mat'];
    OsteoArticularModel(incr_solid).u = [0;0;1];
    OsteoArticularModel(incr_solid).theta = theta_L5(3);

    % L4_J1 %Flexion-Extension
    num_solid=num_solid+1;                        % number of the solid ...
    name=list_solid{num_solid};                                % solid name
    eval(['incr_solid=s_' name ';'])     % number of the solid in the model
    OsteoArticularModel(incr_solid).name=name;                 % solid name
    OsteoArticularModel(incr_solid).sister=0;                
    OsteoArticularModel(incr_solid).child=s_L4_J2;                   
    OsteoArticularModel(incr_solid).mother=s_L5;           
    OsteoArticularModel(incr_solid).a=[0 0 1]'; 
    OsteoArticularModel(incr_solid).joint=1;  
    OsteoArticularModel(incr_solid).limit_sup= 1.5*8.67 *(2*pi/360);
    OsteoArticularModel(incr_solid).limit_inf= -1.5*15.33 *(2*pi/360);
    % OsteoArticularModel(incr_solid).limit_sup= inf;
    % OsteoArticularModel(incr_solid).limit_inf= -inf;
    % OsteoArticularModel(incr_solid).linear_constraint=[incr_solid-3, L4L5_FE]';
    OsteoArticularModel(incr_solid).Visual=0;
    OsteoArticularModel(incr_solid).b=L5_L4JointNode;
    OsteoArticularModel(incr_solid).c=[0 0 0]';
    OsteoArticularModel(incr_solid).m=0;                 
    OsteoArticularModel(incr_solid).I=zeros(3,3);
    
    % L4_J2 %Lateral-Bending
    num_solid=num_solid+1;                        % number of the solid ...
    name=list_solid{num_solid};                                % solid name
    eval(['incr_solid=s_' name ';'])     % number of the solid in the model
    OsteoArticularModel(incr_solid).name=name;                 % solid name
    OsteoArticularModel(incr_solid).sister=0;                
    OsteoArticularModel(incr_solid).child=s_L4;                   
    OsteoArticularModel(incr_solid).mother=s_L4_J1;           
    OsteoArticularModel(incr_solid).a=[0 0 0]'; 
    OsteoArticularModel(incr_solid).joint=1;  
    OsteoArticularModel(incr_solid).limit_inf= -5 *(2*pi/360);
    OsteoArticularModel(incr_solid).limit_sup=  5 *(2*pi/360);
    % OsteoArticularModel(incr_solid).limit_inf= -inf;
    % OsteoArticularModel(incr_solid).limit_sup= inf;
    % OsteoArticularModel(incr_solid).linear_constraint=[incr_solid-3, L4L5_LB]';
    OsteoArticularModel(incr_solid).Visual=0;
    OsteoArticularModel(incr_solid).b=[0 0 0]';
    OsteoArticularModel(incr_solid).c=[0 0 0]';
    OsteoArticularModel(incr_solid).m=0;                 
    OsteoArticularModel(incr_solid).I=zeros(3,3);

    % L4 % Axial-rotation
    num_solid=num_solid+1;                        % number of the solid ...
    name=list_solid{num_solid};                                % solid name
    eval(['incr_solid=s_' name ';'])     % number of the solid in the model
    OsteoArticularModel(incr_solid).name=name;                 % solid name
    OsteoArticularModel(incr_solid).sister=0;                
    OsteoArticularModel(incr_solid).child=s_L3_J1;                   
    OsteoArticularModel(incr_solid).mother=s_L4_J2;           
    OsteoArticularModel(incr_solid).a=[0 0 0]'; 
    OsteoArticularModel(incr_solid).joint=1;  
    OsteoArticularModel(incr_solid).limit_inf= -1.5*2 *(2*pi/360);
    OsteoArticularModel(incr_solid).limit_sup=  1.5*2 *(2*pi/360);
    % OsteoArticularModel(incr_solid).limit_inf= -inf;
    % OsteoArticularModel(incr_solid).limit_sup= inf;
    % OsteoArticularModel(incr_solid).linear_constraint=[incr_solid-3, L4L5_AR]';
    % OsteoArticularModel(incr_solid).calib_k_constraint = num_solid+4; %Same homothetic coeff.
    OsteoArticularModel(incr_solid).Visual=1;
    OsteoArticularModel(incr_solid).b=[0 0 0]';
    OsteoArticularModel(incr_solid).c=CoM_L4;
    OsteoArticularModel(incr_solid).m=MassL4;                           
    OsteoArticularModel(incr_solid).I=IL4;
    OsteoArticularModel(incr_solid).anat_position=L4_position_set;
    OsteoArticularModel(incr_solid).L={'L5_L4JointNode';'L4_L3JointNode'};
    OsteoArticularModel(incr_solid).visual_file = ['Twente/L4.mat'];
    OsteoArticularModel(incr_solid).u = [0;0;1];
    OsteoArticularModel(incr_solid).theta = theta_L4(3);

    % L3_J1 %Flexion-Extension
    num_solid=num_solid+1;                        % number of the solid ...
    name=list_solid{num_solid};                                % solid name
    eval(['incr_solid=s_' name ';'])     % number of the solid in the model
    OsteoArticularModel(incr_solid).name=name;                 % solid name
    OsteoArticularModel(incr_solid).sister=0;                
    OsteoArticularModel(incr_solid).child=s_L3_J2;                   
    OsteoArticularModel(incr_solid).mother=s_L4;           
    OsteoArticularModel(incr_solid).a=[0 0 1]'; 
    OsteoArticularModel(incr_solid).joint=1;  
    OsteoArticularModel(incr_solid).limit_sup= 2 *   6.51 *(2*pi/360);
    OsteoArticularModel(incr_solid).limit_inf= 2 * -11.49 *(2*pi/360);
    % OsteoArticularModel(incr_solid).limit_sup= inf;
    % OsteoArticularModel(incr_solid).limit_inf= -inf;
    % OsteoArticularModel(incr_solid).linear_constraint=[incr_solid-6, L3L4_FE]';
    OsteoArticularModel(incr_solid).Visual=0;
    OsteoArticularModel(incr_solid).b=L4_L3JointNode;
    OsteoArticularModel(incr_solid).c=[0 0 0]';
    OsteoArticularModel(incr_solid).m=0;                 
    OsteoArticularModel(incr_solid).I=zeros(3,3);

    %L3_J2 %Lateral-Bending
    num_solid=num_solid+1;                        % number of the solid ...
    name=list_solid{num_solid};                                % solid name
    eval(['incr_solid=s_' name ';'])     % number of the solid in the model
    OsteoArticularModel(incr_solid).name=name;                 % solid name
    OsteoArticularModel(incr_solid).sister=0;                
    OsteoArticularModel(incr_solid).child=s_L3;                   
    OsteoArticularModel(incr_solid).mother=s_L3_J1;           
    OsteoArticularModel(incr_solid).a=[0 0 0]';
    OsteoArticularModel(incr_solid).joint=1;  
    OsteoArticularModel(incr_solid).limit_inf= 2 * -5*(2*pi/360);
    OsteoArticularModel(incr_solid).limit_sup= 2 *  5*(2*pi/360);
    % OsteoArticularModel(incr_solid).limit_inf= -inf;
    % OsteoArticularModel(incr_solid).limit_sup=  inf;
    % OsteoArticularModel(incr_solid).linear_constraint=[incr_solid-6, L3L4_LB]';
    OsteoArticularModel(incr_solid).Visual=0;
    OsteoArticularModel(incr_solid).b=[0 0 0]';
    OsteoArticularModel(incr_solid).c=[0 0 0]';
    OsteoArticularModel(incr_solid).m=0;                 
    OsteoArticularModel(incr_solid).I=zeros(3,3);

    %L3 % Axial-rotation
    num_solid=num_solid+1;                        % number of the solid ...
    name=list_solid{num_solid};                                % solid name
    eval(['incr_solid=s_' name ';'])     % number of the solid in the model
    OsteoArticularModel(incr_solid).name=name;                 % solid name
    OsteoArticularModel(incr_solid).sister=0;                
    OsteoArticularModel(incr_solid).child=s_L2_J1;                   
    OsteoArticularModel(incr_solid).mother=s_L3_J2;           
    OsteoArticularModel(incr_solid).a=[0 0 0]'; 
    OsteoArticularModel(incr_solid).joint=1;  
    OsteoArticularModel(incr_solid).limit_inf= 2 *-1.5*(2*pi/360);
    OsteoArticularModel(incr_solid).limit_sup= 2 * 1.5*(2*pi/360);
    % OsteoArticularModel(incr_solid).limit_inf= -inf;
    % OsteoArticularModel(incr_solid).limit_sup=  inf;
    % OsteoArticularModel(incr_solid).linear_constraint=[incr_solid-6, L3L4_AR]';
    % OsteoArticularModel(incr_solid).calib_k_constraint = num_solid+4; %Same homothetic coeff.
    OsteoArticularModel(incr_solid).Visual=1;
    OsteoArticularModel(incr_solid).b=[0 0 0]';
    OsteoArticularModel(incr_solid).c=CoM_L3;
    OsteoArticularModel(incr_solid).m=MassL3;                         
    OsteoArticularModel(incr_solid).I=IL3;
    OsteoArticularModel(incr_solid).anat_position=L3_position_set;
    OsteoArticularModel(incr_solid).L={'L4_L3Node';'L3_L2Node'};
    OsteoArticularModel(incr_solid).visual_file = ['Twente/L3.mat'];
    OsteoArticularModel(incr_solid).u = [0;0;1];
    OsteoArticularModel(incr_solid).theta = theta_L3(3);

    %L2_J1 %Flexion-Extension
    num_solid=num_solid+1;                        % number of the solid ...
    name=list_solid{num_solid};                                % solid name
    eval(['incr_solid=s_' name ';'])     % number of the solid in the model
    OsteoArticularModel(incr_solid).name=name;                 % solid name
    OsteoArticularModel(incr_solid).sister=0;                
    OsteoArticularModel(incr_solid).child=s_L2_J2;                   
    OsteoArticularModel(incr_solid).mother=s_L3;           
    OsteoArticularModel(incr_solid).a=[0 0 1]'; 
    OsteoArticularModel(incr_solid).joint=1;  
    OsteoArticularModel(incr_solid).limit_sup= 2 *   4.34 *(2*pi/360);
    OsteoArticularModel(incr_solid).limit_inf= 2 *  -7.66 *(2*pi/360);
    % OsteoArticularModel(incr_solid).limit_sup= inf;
    % OsteoArticularModel(incr_solid).limit_inf= -inf;
    % OsteoArticularModel(incr_solid).linear_constraint=[incr_solid-9, L2L3_FE]';
    OsteoArticularModel(incr_solid).Visual=0;
    OsteoArticularModel(incr_solid).b=L3_L2JointNode;
    OsteoArticularModel(incr_solid).c=[0 0 0]';
    OsteoArticularModel(incr_solid).m=0;                 
    OsteoArticularModel(incr_solid).I=zeros(3,3);

    %L2_J2 %Lateral-Bending
    num_solid=num_solid+1;                        % number of the solid ...
    name=list_solid{num_solid};                                % solid name
    eval(['incr_solid=s_' name ';'])     % number of the solid in the model
    OsteoArticularModel(incr_solid).name=name;                 % solid name
    OsteoArticularModel(incr_solid).sister=0;                
    OsteoArticularModel(incr_solid).child=s_L2;                   
    OsteoArticularModel(incr_solid).mother=s_L2_J1;           
    OsteoArticularModel(incr_solid).a=[0 0 0]';
    OsteoArticularModel(incr_solid).joint=1;  
    OsteoArticularModel(incr_solid).limit_inf= 2 * -5 *(2*pi/360);
    OsteoArticularModel(incr_solid).limit_sup= 2 *  5 *(2*pi/360);
    % OsteoArticularModel(incr_solid).limit_inf= -inf;
    % OsteoArticularModel(incr_solid).limit_sup=  inf;
    % OsteoArticularModel(incr_solid).linear_constraint=[incr_solid-9, L2L3_LB]';
    OsteoArticularModel(incr_solid).Visual=0;
    OsteoArticularModel(incr_solid).b=[0 0 0]';
    OsteoArticularModel(incr_solid).c=[0 0 0]';
    OsteoArticularModel(incr_solid).m=0;                 
    OsteoArticularModel(incr_solid).I=zeros(3,3);

    %L2 % Axial-rotation
    num_solid=num_solid+1;                        % number of the solid ...
    name=list_solid{num_solid};                                % solid name
    eval(['incr_solid=s_' name ';'])     % number of the solid in the model
    OsteoArticularModel(incr_solid).name=name;                 % solid name
    OsteoArticularModel(incr_solid).sister=0;                
    OsteoArticularModel(incr_solid).child=s_L1_J1;                   
    OsteoArticularModel(incr_solid).mother=s_L2_J2;           
    OsteoArticularModel(incr_solid).a=[0 0 0]'; 
    OsteoArticularModel(incr_solid).joint=1;  
    OsteoArticularModel(incr_solid).limit_inf= 2 *-1.5*(2*pi/360);
    OsteoArticularModel(incr_solid).limit_sup= 2 * 1.5*(2*pi/360);
    % OsteoArticularModel(incr_solid).limit_inf= -inf;
    % OsteoArticularModel(incr_solid).limit_sup=  inf;
    % OsteoArticularModel(incr_solid).linear_constraint=[incr_solid-9, L2L3_AR]';
    % OsteoArticularModel(incr_solid).calib_k_constraint = num_solid+4; %Same homothetic coeff.
    OsteoArticularModel(incr_solid).Visual=1;
    OsteoArticularModel(incr_solid).b=[0 0 0]';
    OsteoArticularModel(incr_solid).c=CoM_L2;
    OsteoArticularModel(incr_solid).m=MassL2;                        
    OsteoArticularModel(incr_solid).I=IL2;
    OsteoArticularModel(incr_solid).anat_position=L2_position_set;
    OsteoArticularModel(incr_solid).L={'L3_L2JointNode';'L2_L1JointNode'};
    OsteoArticularModel(incr_solid).visual_file = ['Twente/L2.mat'];  
    OsteoArticularModel(incr_solid).u = [0;0;1];
    OsteoArticularModel(incr_solid).theta = theta_L2(3);

    %L1_J1 %Flexion-Extension
    num_solid=num_solid+1;                        % number of the solid ...
    name=list_solid{num_solid};                                % solid name
    eval(['incr_solid=s_' name ';'])     % number of the solid in the model
    OsteoArticularModel(incr_solid).name=name;                 % solid name
    OsteoArticularModel(incr_solid).sister=0;                
    OsteoArticularModel(incr_solid).child=s_L1_J2;                   
    OsteoArticularModel(incr_solid).mother=s_L2;           
    OsteoArticularModel(incr_solid).a=[0 0 1]'; 
    OsteoArticularModel(incr_solid).joint=1;  
    OsteoArticularModel(incr_solid).limit_sup= 2 *   3.98 *(2*pi/360);
    OsteoArticularModel(incr_solid).limit_inf= 2 *  -7.02 *(2*pi/360);
    % OsteoArticularModel(incr_solid).limit_sup=  inf;
    % OsteoArticularModel(incr_solid).limit_inf= -inf;
    % OsteoArticularModel(incr_solid).linear_constraint=[incr_solid-12, L1L2_FE]';
    OsteoArticularModel(incr_solid).Visual=0;
    OsteoArticularModel(incr_solid).b=L2_L1JointNode;
    OsteoArticularModel(incr_solid).c=[0 0 0]';
    OsteoArticularModel(incr_solid).m=0;                 
    OsteoArticularModel(incr_solid).I=zeros(3,3);

    %L1_J2 %Lateral-Bending
    num_solid=num_solid+1;                        % number of the solid ...
    name=list_solid{num_solid};                                % solid name
    eval(['incr_solid=s_' name ';'])     % number of the solid in the model
    OsteoArticularModel(incr_solid).name=name;                 % solid name
    OsteoArticularModel(incr_solid).sister=0;                
    OsteoArticularModel(incr_solid).child=s_L1;                   
    OsteoArticularModel(incr_solid).mother=s_L1_J1;           
    OsteoArticularModel(incr_solid).a=[0 0 0]';
    OsteoArticularModel(incr_solid).joint=1;  
    OsteoArticularModel(incr_solid).limit_inf= 2 *-5*(2*pi/360);
    OsteoArticularModel(incr_solid).limit_sup= 2 * 5*(2*pi/360);
    % OsteoArticularModel(incr_solid).limit_inf= -inf;
    % OsteoArticularModel(incr_solid).limit_sup=  inf;
    % OsteoArticularModel(incr_solid).linear_constraint=[incr_solid-12, L1L2_LB]';
    OsteoArticularModel(incr_solid).Visual=0;
    OsteoArticularModel(incr_solid).b=[0 0 0]';
    OsteoArticularModel(incr_solid).c=[0 0 0]';
    OsteoArticularModel(incr_solid).m=0;                 
    OsteoArticularModel(incr_solid).I=zeros(3,3);

    %L1 % Axial-rotation
    num_solid=num_solid+1;                        % number of the solid ...
    name=list_solid{num_solid};                                % solid name
    eval(['incr_solid=s_' name ';'])     % number of the solid in the model
    OsteoArticularModel(incr_solid).name=name;                 % solid name
    OsteoArticularModel(incr_solid).sister=0;                
    OsteoArticularModel(incr_solid).child=0;                   
    OsteoArticularModel(incr_solid).mother=s_L1_J2;           
    OsteoArticularModel(incr_solid).a=[0 0 0]'; 
    OsteoArticularModel(incr_solid).joint=1;  
    OsteoArticularModel(incr_solid).limit_inf= 2 *-1*(2*pi/360);
    OsteoArticularModel(incr_solid).limit_sup= 2 * 1*(2*pi/360);
    % OsteoArticularModel(incr_solid).limit_inf= -inf;
    % OsteoArticularModel(incr_solid).limit_sup=  inf;
    % OsteoArticularModel(incr_solid).linear_constraint=[incr_solid-12, L1L2_AR]';
    % OsteoArticularModel(incr_solid).calib_k_constraint = num_solid+4; %Same homothetic coeff.
    OsteoArticularModel(incr_solid).Visual=1;
    OsteoArticularModel(incr_solid).b=[0 0 0]';
    OsteoArticularModel(incr_solid).c=CoM_L1;
    OsteoArticularModel(incr_solid).m=MassL1;                  
    OsteoArticularModel(incr_solid).I=IL1;
    OsteoArticularModel(incr_solid).anat_position=L1_position_set;
    OsteoArticularModel(incr_solid).L={'L2_L1JointNode';'LowerTrunk_UpperTrunkNode'};
    OsteoArticularModel(incr_solid).visual_file = ['Twente/L1.mat'];
    OsteoArticularModel(incr_solid).u = [0;0;1];
    OsteoArticularModel(incr_solid).theta = theta_L1(3);

end